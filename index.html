<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jeu Pédagogique : Le Précompte Professionnel</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<div id="game-container">
    <div id="screen-login" class="screen active">
        <h1>🎓 Module : Le Précompte Professionnel</h1>
        <p>Bienvenue dans ce module d'exercice interactif.</p>
        <div class="info-box">
            <strong>Objectif :</strong> Calculer le précompte professionnel étape par étape selon les nouvelles règles (Formule Clé 2024).
        </div>
        <p>Veuillez vous identifier pour commencer.</p>
        <label>Votre adresse email scolaire :</label>
        <input type="email" id="student-email" placeholder="prenom.nom@istlm.org">
        <button onclick="validateLogin()">Commencer le module</button>
        <div id="login-error" class="feedback error">Veuillez utiliser votre adresse @istlm.org valide.</div>
        
        <div class="intro-footer">
            Ce jeu a été réalisé pour les élèves de Saint-Luc de Frameries par Mr Depret.
        </div>
    </div>

    <div id="screen-scenario" class="screen">
        <h1>Choisis ton dossier</h1>
        <p>Bonjour <span id="display-name" class="highlight"></span> ! Choisis un dossier pour commencer l'exercice :</p>
        
        <div class="scenario-cards">
            <div class="card" onclick="startGame('Sarah', 'Employée', 4200)">
                <div class="avatar">👩🏻‍💼</div>
                <h3>Sarah</h3>
                <p>Employée</p>
                <p><strong>4.200 €</strong> Brut/mois</p>
            </div>
            <div class="card" onclick="startGame('Tom', 'Ouvrier', 4500)">
                <div class="avatar">👷🏼‍♂️</div>
                <h3>Tom</h3>
                <p>Ouvrier</p>
                <p><strong>4.500 €</strong> Brut/mois</p>
            </div>
            <div class="card" onclick="startGame('Julia', 'Employée', 5000)">
                <div class="avatar">👩🏼‍💻</div>
                <h3>Julia</h3>
                <p>Employée</p>
                <p><strong>5.000 €</strong> Brut/mois</p>
            </div>
        </div>
    </div>

    <div id="screen-step1" class="screen">
        <h2>Étape 1 : Revenu Annuel Brut</h2>
        <div class="context-box">
            <strong>Dossier :</strong> <span class="current-role"></span> <span class="current-name"></span><br>
            <strong>Salaire Mensuel Brut :</strong> <span class="current-salary"></span> €
        </div>
        
        <p>Déterminons d'abord le revenu imposable annuel.</p>
        <ul>
            <li>Retire la cotisation ONSS (13,07% pour employés, 13,07% × 1,08 pour ouvriers) du brut mensuel.</li>
            <li>Multiplie le résultat par 12 mois.</li>
        </ul>

        <label>1. Montant de l'ONSS mensuel (€) :</label>
        <input type="number" id="input-onss" step="0.01">
        
        <label>2. Salaire Mensuel Imposable (Brut - ONSS) (€) :</label>
        <input type="number" id="input-monthly-taxable" step="0.01">

        <label>3. Revenu Annuel Brut (€) :</label>
        <input type="number" id="input-annual-gross" step="0.01">

        <button onclick="checkStep1()">Valider l'étape 1</button>
        <div id="feedback-step1" class="feedback"></div>
    </div>

    <div id="screen-step2" class="screen">
        <h2>Étape 2 : Revenu Net Imposable</h2>
        <p>Soustrayons les <strong>frais professionnels forfaitaires</strong>.</p>
        
        <div class="warning-box">
            <strong>Rappel des barèmes :</strong><br>
            - Jusqu'à 19.166,67 € : 30%<br>
            - Supérieur à 19.166,67 € : Forfait max de 5.750 €
        </div>

        <p>Ton Revenu Annuel Brut est de : <strong><span class="val-annual-gross"></span> €</strong></p>

        <label>1. Montant des frais professionnels (€) :</label>
        <input type="number" id="input-expenses" step="0.01">

        <label>2. Revenu Annuel Net Imposable (Brut annuel - Frais) (€) :</label>
        <input type="number" id="input-net-taxable" step="0.01">

        <button onclick="checkStep2()">Valider l'étape 2</button>
        <div id="feedback-step2" class="feedback"></div>
    </div>

    <div id="screen-step3" class="screen">
        <h2>Étape 3 : Calcul de l'Impôt de Base</h2>
        <p>Calcule l'impôt de base sur le <strong>Revenu Annuel Net Imposable (<span class="val-net-taxable"></span> €)</strong> à l'aide du barème.</p>

        <table>
            <tr>
                <th>Tranche de revenu (€)</th>
                <th>Impôt de base</th>
            </tr>
            <tr>
                <td>0,01 à 15.830 €</td>
                <td>26,75 %</td>
            </tr>
            <tr>
                <td>15.830,01 à 27.940 €</td>
                <td>4.234,53 € + 42,80 % sur la tranche > 15.830 €</td>
            </tr>
            <tr>
                <td>27.940,01 à 48.350 €</td>
                <td>9.417,61 € + 48,15 % sur la tranche > 27.940 €</td>
            </tr>
            <tr>
                <td>Supérieur à 48.350 €</td>
                <td>19.245,03 € + 53,50 % sur la tranche > 48.350 €</td>
            </tr>
        </table>

        <label>Montant de l'impôt de base calculé (€) :</label>
        <input type="number" id="input-base-tax" step="0.01">

        <button onclick="checkStep3()">Valider l'étape 3</button>
        <div id="feedback-step3" class="feedback"></div>
    </div>

    <div id="screen-step4" class="screen">
        <h2>Étape 4 : Précompte Professionnel Mensuel</h2>
        <p>Calculons l'impôt annuel final et le précompte mensuel.</p>
        <ol>
            <li>Soustraire la réduction pour quotité exemptée (Montant fixe 2024 : <strong>2.830,15 €</strong>).</li>
            <li>Diviser le résultat par 12.</li>
        </ol>

        <p>Ton Impôt de base : <strong><span class="val-base-tax"></span> €</strong></p>

        <label>1. Impôt Annuel (Impôt de base - 2.830,15 €) :</label>
        <input type="number" id="input-annual-tax" step="0.01">

        <label>2. Précompte Professionnel Mensuel (/ 12) :</label>
        <input type="number" id="input-final-prp" step="0.01">

        <button onclick="checkStep4()">Valider le calcul final</button>
        <div id="feedback-step4" class="feedback"></div>
    </div>

    <div id="screen-end" class="screen" id="print-screen">
        <h1 class="success-title">Félicitations ! 🎉</h1>
        <p>Bravo <span class="final-student-name"></span>, tu as complété le calcul avec succès.</p>
        
        <div class="result-card">
            <h3>Fiche de synthèse - Précompte Professionnel</h3>
            <p><strong>Élève :</strong> <span class="final-student-email"></span></p>
            <p><strong>Dossier traité :</strong> <span class="current-name"></span> (<span class="current-salary"></span> € Brut)</p>
            <hr>
            <table class="final-table">
                <tr><td>Salaire Mensuel Brut :</td><td><span class="current-salary"></span> €</td></tr>
                <tr><td>(-) ONSS (13,07%) :</td><td>- <span class="res-onss"></span> €</td></tr>
                <tr><td>(=) Brut Mensuel Imposable :</td><td><span class="res-monthly-taxable"></span> €</td></tr>
                <tr><td><strong>Revenu Annuel Brut (x12) :</strong></td><td><strong><span class="res-annual-gross"></span> €</strong></td></tr>
                <tr><td>(-) Frais Professionnels :</td><td>- <span class="res-expenses"></span> €</td></tr>
                <tr><td><strong>(=) Net Imposable Annuel :</strong></td><td><strong><span class="res-net-taxable"></span> €</strong></td></tr>
                <tr><td>Impôt de Base :</td><td><span class="res-base-tax"></span> €</td></tr>
                <tr><td>(-) Réduction Quotité Exemptée :</td><td>- 2.830,15 €</td></tr>
                <tr><td>(=) Impôt Annuel :</td><td><span class="res-annual-tax"></span> €</td></tr>
                <tr class="total-row"><td><strong>PRÉCOMPTE MENSUEL :</strong></td><td><strong><span class="res-final-prp"></span> €</strong></td></tr>
            </table>
        </div>

        <button class="secondary" onclick="window.print()">🖨️ Imprimer mon travail</button>
        <button onclick="location.reload()">Recommencer avec un autre dossier</button>
    </div>

</div>

<div id="calculator-container">
    <h3 style="color:white; margin-bottom:10px;">Calculette</h3>
    <div id="calc">
        <input type="text" id="calc-display" readonly>
        <div class="calc-grid">
            <button class="calc-btn clr" onclick="clearCalc()">C</button>
            <button class="calc-btn op" onclick="appendCalc('/')">÷</button>
            <button class="calc-btn op" onclick="appendCalc('*')">×</button>
            <button class="calc-btn op" onclick="appendCalc('%')">%</button>
            
            <button class="calc-btn" onclick="appendCalc('7')">7</button>
            <button class="calc-btn" onclick="appendCalc('8')">8</button>
            <button class="calc-btn" onclick="appendCalc('9')">9</button>
            <button class="calc-btn op" onclick="appendCalc('-')">-</button>
            
            <button class="calc-btn" onclick="appendCalc('4')">4</button>
            <button class="calc-btn" onclick="appendCalc('5')">5</button>
            <button class="calc-btn" onclick="appendCalc('6')">6</button>
            <button class="calc-btn op" onclick="appendCalc('+')">+</button>
            
            <button class="calc-btn" onclick="appendCalc('1')">1</button>
            <button class="calc-btn" onclick="appendCalc('2')">2</button>
            <button class="calc-btn" onclick="appendCalc('3')">3</button>
            <button class="calc-btn eq" onclick="calculate()">=</button>
            
            <button class="calc-btn" onclick="appendCalc('0')">0</button>
            <button class="calc-btn" onclick="appendCalc('.')">.</button>
        </div>
    </div>
    <p style="color:#bdc3c7; font-size:0.8em; text-align:center; margin-top:20px;">Utilise cette calculette pour tes opérations.</p>
</div>

<script src="script.js"></script>
</body>
</html>